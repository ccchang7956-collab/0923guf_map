# 光復災害地圖系統

這是一個基於HTML、JavaScript和OpenStreetMap的災害設施地圖系統，可以顯示光復鄉的各種災害應急設施。

## 功能特色

- 📍 **互動式地圖**: 使用OpenStreetMap顯示設施位置，限制在花蓮縣範圍內
- 📊 **儀表板**: 即時顯示各類設施的數量統計
- 🔍 **智能搜索**: 快速搜索設施名稱、地址或類型
- 📍 **用戶定位**: 自動獲取用戶位置並顯示附近設施
- 🎨 **Font Awesome圖標**: 使用專業圖標美化界面
- 🔗 **Google Maps整合**: 點擊地址直接開啟Google Maps導航
- 🗂️ **分類篩選**: 可按設施類型進行篩選顯示
- 📱 **響應式設計**: 支援桌面和行動裝置
- 📋 **詳細資料表**: 顯示所有設施的詳細資訊

## 設施類型

1. **流動廁所** 🚽 - 橙色標記
2. **沐浴站** 🚿 - 綠色標記  
3. **取水站** 💧 - 藍色標記

## 文件結構

```
├── index.html          # 主要HTML頁面
├── app.js             # 主要JavaScript應用邏輯
├── kml-parser.js      # KML文件解析器
├── 光復災區地圖.kml    # KML數據文件
└── README.md          # 說明文件
```

## 使用方法

### 方法一：本地服務器（推薦）

1. 在專案目錄中開啟命令列
2. 啟動Python HTTP服務器：
   ```bash
   python -m http.server 8000
   ```
3. 在瀏覽器中開啟：`http://localhost:8000`

### 方法二：直接開啟文件

1. 直接用瀏覽器開啟 `index.html` 文件
2. 注意：某些瀏覽器可能會阻擋本地文件的AJAX請求

## 主要功能說明

### 🔍 搜索功能
- **即時搜索**: 在搜索框中輸入關鍵字，系統會即時顯示相關結果
- **多欄位搜索**: 支援搜索設施名稱、地址、類型或備註
- **搜索結果**: 最多顯示5個結果，點擊可直接定位到該設施
- **鍵盤快捷鍵**: 
  - `Enter`: 執行搜索
  - `ESC`: 清除搜索結果
- **自動聚焦**: 搜索時地圖會自動調整視野包含所有結果

### 📍 用戶定位功能
- **一鍵定位**: 點擊「定位」按鈕獲取您的當前位置
- **位置標記**: 用藍色脈動圓點標示您的位置
- **附近設施**: 自動顯示5公里內的設施，按距離排序
- **位置驗證**: 檢查是否在花蓮縣範圍內
- **精度顯示**: 顯示定位精度（以米為單位）

### 🗺️ 地圖操作
- **地理限制**: 地圖限制在花蓮縣範圍內，防止迷失方向
- **縮放控制**: 最小縮放級別9，最大縮放級別18
- **縮放按鈕**: 使用滑鼠滾輪或右上角的放大/縮小按鈕
- **拖拽**: 點擊並拖拽地圖移動視角
- **標記互動**: 
  - 點擊標記查看詳細資訊
  - Hover效果：標記會放大1.1倍
  - 點擊地址連結開啟Google Maps

### 🗂️ 篩選功能
- **按鈕篩選**: 快速選擇要顯示的設施類型
- **下拉篩選**: 表格右上角的精確篩選選項
- **雙向同步**: 按鈕和下拉選單會自動同步
- **即時更新**: 地圖和表格同步更新顯示內容

### 📊 儀表板
- **統計卡片**: 顯示每種設施類型的地點數量和總設施數量
- **即時更新**: 根據篩選條件自動更新統計數據
- **Hover效果**: 卡片具有陰影提升效果
- **圖標識別**: 每種設施類型都有對應的Font Awesome圖標

### 📋 詳細資料表
- **完整資訊**: 顯示所有設施的名稱、類別、地址、備註
- **可點擊地址**: 每個地址都可點擊開啟Google Maps
- **圖標化顯示**: 使用Font Awesome圖標美化界面
- **響應式表格**: 在小螢幕上可水平滾動

## 技術架構

### 前端技術
- **HTML5**: 頁面結構
- **Tailwind CSS**: 樣式框架，提供現代化UI設計
- **JavaScript (ES6+)**: 應用邏輯和互動功能
- **Leaflet.js**: 開源地圖庫，用於顯示OpenStreetMap

### 數據處理
- **KML解析**: 自定義KML解析器處理地理數據
- **座標轉換**: 支援多種座標格式
- **數據驗證**: 確保數據完整性和正確性

### 地圖服務
- **OpenStreetMap**: 開源地圖瓦片服務
- **自定義標記**: 彩色圓形標記區分不同設施類型

## 數據來源

KML數據文件 (`光復災區地圖.kml`) 包含：
- 設施名稱和地址
- 設施類型分類
- 地理座標位置
- 設施數量備註

## 瀏覽器支援

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 故障排除

### 地圖無法載入
1. 確認網路連線正常
2. 檢查瀏覽器控制台是否有錯誤訊息
3. 嘗試重新整理頁面

### KML數據載入失敗
1. 確認 `光復災區地圖.kml` 文件存在
2. 如果直接開啟HTML文件，嘗試使用本地服務器
3. 檢查瀏覽器控制台的錯誤訊息

### 標記不顯示
1. 檢查KML文件中的座標格式
2. 確認設施類型名稱正確
3. 查看瀏覽器控制台的解析日誌

## 擴展功能

此系統設計具有擴展性，可以輕鬆添加：

1. **新的設施類型**: 在 `facilityTypes` 配置中添加新類型
2. **更多地圖圖層**: 如衛星圖、地形圖等
3. **搜索功能**: 按名稱或地址搜索設施
4. **路線規劃**: 整合導航功能
5. **即時更新**: 連接後端API進行數據同步

## 開發說明

### 修改設施類型配置
在 `app.js` 中的 `facilityTypes` 物件：

```javascript
const facilityTypes = {
    '設施類型名稱': {
        color: '#顏色代碼',
        icon: '圖示符號',
        countElement: 'HTML元素ID',
        totalElement: 'HTML元素ID'
    }
};
```

### 自定義標記樣式
修改 `createCustomMarker` 函數中的CSS樣式。

### 添加新的篩選按鈕
1. 在HTML中添加按鈕
2. 在 `setupEventListeners` 中添加事件監聽
3. 確保 `filterFacilities` 函數支援新類型

## 授權

此專案僅供災害應急使用，請確保數據的準確性和時效性。